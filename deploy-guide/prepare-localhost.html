
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Prepare localhost &#8212; socok8s  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Prepare the target hosts" href="prepare-targets.html" />
    <link rel="prev" title="Overview" href="overview.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="prepare-localhost">
<span id="preparelocalhost"></span><h1>Prepare localhost<a class="headerlink" href="#prepare-localhost" title="Permalink to this headline">¶</a></h1>
<div><img height="360" src="../_images/blockdiag-11dc1aee24ccae80667045fc563a875f5711faca.png" width="832" /></div><div class="section" id="base-software">
<h2>Base software<a class="headerlink" href="#base-software" title="Permalink to this headline">¶</a></h2>
<p>Install the following software on your <cite>localhost</cite>:</p>
<blockquote>
<div><ul class="simple">
<li>jq</li>
<li>ipcalc</li>
<li>git</li>
<li>python-virtualenv</li>
</ul>
</div></blockquote>
<p>Optionally, <cite>localhost</cite> can be preinstalled with the following software:</p>
<blockquote>
<div><ul class="simple">
<li>ansible&gt;=2.7.0</li>
<li>python-openstackclient</li>
<li>python-requests</li>
<li>python-jmespath</li>
<li>python-openstacksdk</li>
<li>python-netaddr</li>
</ul>
</div></blockquote>
<p>Make sure to install the variant of the packages that matches the Python
release that ansible is using. (e.g. on Tumbleweed, Ansible is using Python 3,
so install the “python3-” variant of the packages)</p>
<p>If those optional software aren’t installed, they will be installed in a
venv in <cite>~/.socok8svenv</cite>.</p>
</div>
<div class="section" id="cloning-this-repository">
<h2>Cloning this repository<a class="headerlink" href="#cloning-this-repository" title="Permalink to this headline">¶</a></h2>
<p>To get started, you need to clone this repository. This repository uses
submodules, so you need to get all the code to make sure the playbooks
work.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recursive</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">SUSE</span><span class="o">-</span><span class="n">Cloud</span><span class="o">/</span><span class="n">socok8s</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>Alternatively, one can fetch/update the tree of the submodules by
running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">submodule</span> <span class="n">update</span> <span class="o">--</span><span class="n">init</span> <span class="o">--</span><span class="n">recursive</span>
</pre></div>
</div>
</div>
<div class="section" id="set-a-deployment-mechanism">
<span id="deploymechanism"></span><h2>Set a deployment mechanism<a class="headerlink" href="#set-a-deployment-mechanism" title="Permalink to this headline">¶</a></h2>
<p>This tooling can deploy its software on top of OpenStack, KVM, and, in the
future, on bare metal.</p>
<p>This behaviour can be changed by setting the environment variable
<cite>DEPLOYMENT_MECHANISM</cite>.</p>
<p>For example, if you want to bring your own CaaSP/SES cluster, run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export DEPLOYMENT_MECHANISM=&#39;KVM&#39;</span>
</pre></div>
</div>
<p>Alternatively, if you want to deploy CaaSP, SES, OpenStack-Helm, and/or Airship
on top of an OpenStack environment (for CI for example), run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export DEPLOYMENT_MECHANISM=&#39;openstack&#39;</span>
</pre></div>
</div>
<p>OpenStack is the current default behaviour.</p>
<div class="section" id="configure-openstack-deployment-mechanism">
<span id="configureopenstackdeploymentmechanism"></span><h3>Configure OpenStack deployment mechanism<a class="headerlink" href="#configure-openstack-deployment-mechanism" title="Permalink to this headline">¶</a></h3>
<p>In the case you are not bringing your own environment, this socok8s tooling can
deploy CaaSP, SES, and/or a deployer on its own with the help of OpenStack.</p>
<p>Make sure your environment have an openstack client configuration file.
For that, you can create the <code class="docutils literal notranslate"><span class="pre">~/.config/openstack/clouds.yaml</span></code>.</p>
<p>Replace the username and password with your appropriate credentials in
the following example if you are running on engcloud (SUSE employees):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">clouds</span><span class="p">:</span>
  <span class="n">engcloud</span><span class="p">:</span>
    <span class="n">region_name</span><span class="p">:</span> <span class="n">CustomRegion</span>
    <span class="n">auth</span><span class="p">:</span>
      <span class="n">auth_url</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">engcloud</span><span class="o">.</span><span class="n">prv</span><span class="o">.</span><span class="n">suse</span><span class="o">.</span><span class="n">net</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">v3</span>
      <span class="n">username</span><span class="p">:</span> <span class="n">foctodoodle</span> <span class="c1"># your username here</span>
      <span class="n">password</span><span class="p">:</span> <span class="n">my</span><span class="o">-</span><span class="nb">super</span><span class="o">-</span><span class="n">secret</span><span class="o">-</span><span class="n">password</span> <span class="c1"># your password here or add it into secure.yaml</span>
      <span class="n">project_name</span><span class="p">:</span> <span class="n">cloud</span>
      <span class="n">project_domain_name</span><span class="p">:</span> <span class="n">default</span>
      <span class="n">user_domain_name</span><span class="p">:</span> <span class="n">ldap_users</span>
    <span class="n">identity_api_version</span><span class="p">:</span> <span class="mi">3</span>
    <span class="n">cacert</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">trust</span><span class="o">/</span><span class="n">anchors</span><span class="o">/</span><span class="n">SUSE_Trust_Root</span><span class="o">.</span><span class="n">crt</span><span class="o">.</span><span class="n">pem</span>
<span class="n">ansible</span><span class="p">:</span>
  <span class="n">use_hostnames</span><span class="p">:</span> <span class="kc">True</span>
  <span class="n">expand_hostvars</span><span class="p">:</span> <span class="kc">False</span>
  <span class="n">fail_on_errors</span><span class="p">:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>SUSE Employees, you can access the engcloud web UI at <a class="reference external" href="https://engcloud.prv.suse.net/">https://engcloud.prv.suse.net/</a>.
For more information, see <a class="reference external" href="https://wiki.microfocus.net/index.php/SUSE/ECP">https://wiki.microfocus.net/index.php/SUSE/ECP</a>.
If you don’t have the SUSE root certificate installed, check
<a class="reference external" href="http://ca.suse.de/">http://ca.suse.de/</a> , or you can set <code class="docutils literal notranslate"><span class="pre">insecure:</span> <span class="pre">True</span></code> (not recommended).</p>
<p>Now pre-create your environment. It is convention here to use your username
as part of the name of objects you create.</p>
<p>Create a keypair on engcloud (using either the horizon’s web interface or
OpenStack CLI’s <code class="docutils literal notranslate"><span class="pre">openstack</span> <span class="pre">keypair</span> <span class="pre">create</span></code>) for accessing the
instances created. Remember the name of this keypair (which appears as
<code class="docutils literal notranslate"><span class="pre">foctodoodle-key</span></code> in the example below)</p>
<p>Set this for all the following scripts:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export OS_CLOUD=engcloud # Assuming you followed the example for clouds.yaml</span>
<span class="gp">#</span> Your username plus whatever <span class="k">else</span> you would like, will be used <span class="k">for</span> naming
<span class="gp">#</span> objects you create in the cloud
<span class="go">export PREFIX=foctodoodle</span>
<span class="gp">#</span> Set the name of the keypair you created
<span class="go">export KEYNAME=foctodoodle-key</span>
<span class="gp">#</span> Set the name of the subnet you created
<span class="go">export INTERNAL_SUBNET=${PREFIX}-subnet</span>
</pre></div>
</div>
<p>Now create a network, a subnet, a router and a connection to the
floating network (you only have to do it once):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">openstack network create ${PREFIX}-net</span>
<span class="go">openstack subnet create --network ${PREFIX}-net --subnet-range 192.168.100.0/24 ${PREFIX}-subnet</span>
<span class="go">openstack router create ${PREFIX}-router</span>
<span class="go">openstack router set --external-gateway floating ${PREFIX}-router</span>
<span class="go">openstack router add subnet ${PREFIX}-router ${PREFIX}-subnet</span>
</pre></div>
</div>
<p>Prior to executing scripts, be aware that you may need to do some
cleanup prior to retrying scripts or playbooks should they fail. In some
steps a teardown script is provided to clean up any created resources.
Reconfirming that you’ve done all the previous steps to set up now will
save you some time later.</p>
</div>
<div class="section" id="configure-kvm-deployment-mechanism">
<h3>Configure KVM deployment mechanism<a class="headerlink" href="#configure-kvm-deployment-mechanism" title="Permalink to this headline">¶</a></h3>
<p>The KVM support is work in progress, and the next step
(<cite>setup_hosts</cite>) cannot run in KVM. Currently, for KVM, only the setup of
airship/osh is supported. Therefore there is no extra task (other than
setting the environment variable, see <a class="reference internal" href="#deploymechanism"><span class="std std-ref">Set a deployment mechanism</span></a>)
required when running in your own KVM environment.</p>
</div>
</div>
<div class="section" id="configure-ansible">
<h2>Configure Ansible<a class="headerlink" href="#configure-ansible" title="Permalink to this headline">¶</a></h2>
<div class="section" id="use-ara">
<h3>Use ARA<a class="headerlink" href="#use-ara" title="Permalink to this headline">¶</a></h3>
<p>To use ARA, set the following environment variable before running <cite>run.sh</cite>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export USE_ARA=&#39;True&#39;</span>
</pre></div>
</div>
<p>To setup ARA more permanently for your user on <cite>localhost</cite>, create an ansible
configuration file loading ara plugins:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python -m ara.setup.ansible | tee ~/.ansible.cfg</span>
</pre></div>
</div>
<p>For more details on ARA’s web interface, please read
<a class="reference external" href="https://ara.readthedocs.io/en/stable/webserver.html">https://ara.readthedocs.io/en/stable/webserver.html</a> .</p>
</div>
<div class="section" id="enable-mitogen">
<h3>Enable mitogen<a class="headerlink" href="#enable-mitogen" title="Permalink to this headline">¶</a></h3>
<p>To improve deployment speed, enable mitogen strategy and connection plugin.
First install mitogen in your venv (e.g. <cite>~/.socok8svenv/</cite> or your local
ansible environment), then enable it using environment variables.</p>
<p>Alternatively, enable it for all your ansible calls by adding it to your
ansible configuration:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cat &lt; EOF &gt;&gt; ~/.ansible.cfg</span>
<span class="go">strategy_plugins=/root/.socok8s/lib/python3.6/site-packages/ansible_mitogen/plugins/strategy</span>
<span class="go">strategy = mitogen_linear</span>
<span class="go">EOF</span>
</pre></div>
</div>
<p>For more details on mitogen, please read
<a class="reference external" href="https://mitogen.readthedocs.io/en/latest/ansible.html">https://mitogen.readthedocs.io/en/latest/ansible.html</a> .</p>
</div>
<div class="section" id="enable-pipelining">
<h3>Enable pipelining<a class="headerlink" href="#enable-pipelining" title="Permalink to this headline">¶</a></h3>
<p>You might want to improve SSH connections by enabling pipelining:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cat &lt; EOF &gt;&gt; ~/.ansible.cfg</span>
<span class="go">[ssh_connection]</span>
<span class="go">pipelining = True</span>
<span class="go">EOF</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/suse_logo_w-tag_color.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">socok8s</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=SUSE-Cloud&repo=socok8s&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Deployment Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Prepare localhost</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#base-software">Base software</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cloning-this-repository">Cloning this repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set-a-deployment-mechanism">Set a deployment mechanism</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configure-openstack-deployment-mechanism">Configure OpenStack deployment mechanism</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-kvm-deployment-mechanism">Configure KVM deployment mechanism</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configure-ansible">Configure Ansible</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#use-ara">Use ARA</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enable-mitogen">Enable mitogen</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enable-pipelining">Enable pipelining</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="prepare-targets.html">Prepare the target hosts</a></li>
<li class="toctree-l2"><a class="reference internal" href="configure-environment.html">Configure the deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup-openstack.html">Setup OpenStack</a></li>
<li class="toctree-l2"><a class="reference internal" href="verify-openstack.html">Verify OpenStack operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="next-steps.html">Next steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributor.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User scenarios</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operations.html">Operations Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Deployment Guide</a><ul>
      <li>Previous: <a href="overview.html" title="previous chapter">Overview</a></li>
      <li>Next: <a href="prepare-targets.html" title="next chapter">Prepare the target hosts</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, SUSE.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/deploy-guide/prepare-localhost.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/SUSE-Cloud/socok8s" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>